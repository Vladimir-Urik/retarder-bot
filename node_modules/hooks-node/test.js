var 	express = require('express')
		,app = express();

app.set('view engine', 'm')
app.engine('m', require('hogan-express'))

app.get('/', function(req,res){
    res.render("index", { name:'Chris', greeting:'how are you' });
})

function before(){
	var fs = require('fs');
	console.log(fs.existsSync('views/index.m'));

	if(!fs.existsSync('views/index.m')) {
			console.log('Fetch template!');
			require('request')('https://raw.github.com/dpweb/common/master/m/test.m', function(e,r,b){
					if(!e && r.statusCode==200) {
							fs.writeFileSync('./views/index.m', b);
					}
			})
	}
	
}

function after(){
	console.log('after', arguments);
}

var hook = require('./hooks-node.js');
hook(before, app, 'render', after);

app.listen(3000);
console.log('listening on 3000');
